"use strict";(()=>{var u=class r{value;constructor(t){this.value=t>>>0}static from(t){let e=new r(0),n=0,a=!0;for(let o=0;o<t.length;o++){let s=t[o];if(s!=":"&&(a=!a,!a)){switch(s){case"C":case"R":case"W":case"S":e=e.setCornerAt(3-n%4+(n/4>>>0)*4,1);break;case"P":e=e.setCornerAt(3-n%4+(n/4>>>0)*4,2);break;case"c":e=e.setCornerAt(3-n%4+(n/4>>>0)*4,3);break}n++}}return new r(e.value>>>0)}get[Symbol.toStringTag](){return"Shape"}toFilled(){return new r((this.value|this.value>>>16)&65535)}layerCount(){return 4-((Math.clz32(this.toFilled().value)-16)/4>>>0)}toString(){let t=this.layerCount(),e="";return e+=this.cornerString(3),e+=this.cornerString(2),e+=this.cornerString(1),e+=this.cornerString(0),t<=1||(e+=":",e+=this.cornerString(7),e+=this.cornerString(6),e+=this.cornerString(5),e+=this.cornerString(4),t==2)||(e+=":",e+=this.cornerString(11),e+=this.cornerString(10),e+=this.cornerString(9),e+=this.cornerString(8),t==3)||(e+=":",e+=this.cornerString(15),e+=this.cornerString(14),e+=this.cornerString(13),e+=this.cornerString(12)),e}cornerString(t){switch(this.cornerAt(t)){case 1:return"Cu";case 2:return"P-";case 3:return"cu";default:return"--"}}setCornerAt(t,e){return new r(this.value&~(1<<t>>>0)&~(1<<t+16)|(e&1)<<t>>>0|(e&2)<<t+15>>>0)}cornerAt(t){return this.value>>>t&1|this.value>>>t+15&2}hasCrystalOnTopLayer(){let t=this.toFilled().value;t|=(t&30583)<<1,t|=(t&13107)<<2;let e=this.value>>>(3-(Math.clz32(t)-16)/4>>>0)*4&983055;return(e>>>16&e)!==0}unstack(){if(this.value==0)return[new r(0),new r(0)];let t=983055<<(this.layerCount()-1)*4>>>0;return[new r(this.value&~t),new r(this.value&t)]}removeBottomEmpty(){if(this.value==0)return new r(0);let t=983055,e=this.value;for(;e!==0&&!(e&t);)e>>>=4;return new r(e)}unsafeRight(){return new r(this.value&858993459)}unsafeLeft(){return new r(this.value&-858993460)}unsafeUp(){return new r(this.value&2576980377)}unsafeDown(){return new r(this.value&1717986918)}isLeftRightValid(){let t=this.unsafeRight(),e=this.unsafeLeft();return e.collapse().value==e.value&&t.collapse().value==t.value}isUpDownValid(){let t=this.unsafeUp(),e=this.unsafeDown();return t.collapse().value==t.value&&e.collapse().value==e.value}rotate90(){return new r((this.value&4008636142)>>>1|(this.value&286331153)<<3)}rotate180(){return this.rotate90().rotate90()}rotate270(){return this.rotate180().rotate90()}collapse(){let t=this.supported();if(t.value==this.value)return this;let e=this.value&~t,n=e&e>>>16;e&=~(n|n<<16)>>>0;let a=t;for(;e!=0;){let o=new r(e).firstGroup();e=e&~o.value;let s=3;for(let i=0;i<4;i++)if(o.toFilled().value>>>i*4&a.toFilled().value||o.value>>>i*4<<i*4>>>0!=o.value){s=i-1;break}a=new r(a.value|(o.value&65535)>>>s*4|o.value>>>s*4&-65536)}return a}supported(){let t=new r(0),e=new r(this.value&983055);for(;e.value!==t.value;){t=e;for(let n=0;n<16;n++)this.isSupported(this,n,t)&&(e=e.setCornerAt(n,this.cornerAt(n)))}return t}isSupported(t,e,n){return t.cornerAt(e)===0?!1:!(e/4>>>0)||n.cornerAt(e)!==0||n.cornerAt(this.below(e))!=0||t.cornerAt(e)!=2&&t.cornerAt(this.rotatePosition(e))!=2&&n.cornerAt(this.rotatePosition(e))!=0||t.cornerAt(e)!=2&&t.cornerAt(this.rotatePosition(this.rotatePosition(this.rotatePosition(e))))!=2&&n.cornerAt(this.rotatePosition(this.rotatePosition(this.rotatePosition(e))))!=0||t.cornerAt(e)==3&&n.cornerAt(this.above(e))==3}rotatePosition(t){return(t+1)%4+(t/4>>>0)*4}below(t){return t<4?t:t-4}above(t){return t>=3*4?t:t+4}firstGroup(){for(let t=0;t<16;t++)if(this.cornerAt(t)!=0){let e=this.connectedGroup(t,new r(0)),n=e.toFilled().value,a=this.toFilled().value&~n;if(!(n>>>4&a)&&!(n>>>8&a)&&!(n>>>12&a))return e}return new r(0)}connectedGroup(t,e){return this.cornerAt(t)==0||e.cornerAt(t)==1||e.cornerAt(t)==3?e:this.cornerAt(t)==2?e.setCornerAt(t,2):(e=e.setCornerAt(t,this.cornerAt(t)),this.cornerAt(this.rotatePosition(t))==1&&(e=this.connectedGroup(this.rotatePosition(t),e)),this.cornerAt(this.rotatePosition(this.rotatePosition(this.rotatePosition(t))))==1&&(e=this.connectedGroup(this.rotatePosition(this.rotatePosition(this.rotatePosition(t))),e)),e)}mirror(){let i=this.value;return i=i&1717986918|(i&286331153)<<3|(i&2290649224)>>>3,i=i&-1717986919|(i&572662306)<<1|(i&1145324612)>>>1,new r(i)}isMinimal(){let t=this.value;return t===Math.min(t,this.rotate90().value,this.rotate180().value,this.rotate270().value,this.mirror().value,this.mirror().rotate90().value,this.mirror().rotate180().value,this.mirror().rotate270().value)}unstackWithoutCrystals(){let[t,e]=this.unstack(),n=new r(t.value|e.crystals().value),a=new r(e.value&~e.crystals().value);return[n,a]}crystals(){let t=this.value;return t=t&t>>>16,new r(t|t<<16)}};var m=fetch("./hardcoded-pins.json").then(r=>r.json()),v=fetch("./hardcoded-stacks.json").then(r=>r.json()),w=fetch("./hardcoded-halfs.json").then(r=>r.json()).then(r=>Object.fromEntries(Object.entries(r).map(([t,e])=>[t,{shape:+t,...e}]))),h=class r{constructor(t,e,n=new u(0),a=new u(0)){this.shape=t;this.operation=e;this.original1=n;this.original2=a}static async from(t){if(t.layerCount()<=1)return new r(t,"trivial");let e=(await w)[t.value];if(e)return new r(t,e.operation,new u(e.original1??0),new u(e.original2??0));let n=(await m)[t.value];if(n)return new r(t,"pushPins",new u(n));let a=(await v)[t.value];if(a)return new r(t,"stack",new u(a),new u(t.value&~a).removeBottomEmpty());if(!t.hasCrystalOnTopLayer()){let[i,c]=t.unstack();return new r(t,"stack",i,c.removeBottomEmpty())}if(t.isLeftRightValid())return new r(t,"combine",t.unsafeLeft(),t.unsafeRight());if(t.isUpDownValid())return new r(t,"rotate",t.rotate270());if(!t.isMinimal())return t.rotate90().isMinimal()||t.rotate180().isMinimal()||t.rotate270().isMinimal()?new r(t,"rotate",t.rotate270()):new r(t,"mirror",t.mirror());let[o,s]=t.unstackWithoutCrystals();return new r(t,"stack",o,s)}};function b(r,t){t.innerHTML='<path fill="#f00" stroke="#000" stroke-width="3" d="M 50 50 L 50 25 L 0 0 L 25 50 Z" />'}async function S(){Object.assign(globalThis,{solve:f}),f("----CuCu:----Cu--:----P-cr:----Cucr")}location.hostname=="localhost"&&(new EventSource("/esbuild").onmessage=()=>location.reload());S();async function f(r){async function t(n,a,o=!1){let s="",i=await h.from(n);if(i.operation=="mirror")return t(n.mirror(),a,!o);let c=o&&i.operation=="right"?"left":i.operation;function l(p){return(o?p.mirror():p).toString()}return i.original1&&i.original2?(s+="&nbsp;&nbsp;&nbsp;&nbsp;".repeat(a)+l(n)+' = <span style="color:blue">'+c+'</span> <span style="color:magenta">'+l(i.original1)+'</span> + </span> <span style="color:red">'+l(i.original2)+"</span><br />",i.original1.layerCount()>1&&i.original2.layerCount()>1&&a++,i.original1.layerCount()>1&&(s+=await t(i.original1,a)),i.original2.layerCount()>1&&(s+=await t(i.original2,a))):i.original1?(s+="&nbsp;&nbsp;&nbsp;&nbsp;".repeat(a)+l(n)+' = <span style="color:blue">'+c+'</span> <span style="color:magenta">'+l(i.original1)+"</span><br />",i.original1.layerCount()>1&&(s+=await t(i.original1,a))):s+="&nbsp;&nbsp;&nbsp;&nbsp;".repeat(a)+l(n)+' = <span style="color:blue">'+c+"</span><br />",s}let e=document.getElementById("output");e.innerHTML=await t(u.from(r),0),b(u.from(r),document.getElementById("svg"))}})();
//# sourceMappingURL=main.js.map
